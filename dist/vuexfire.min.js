/*!
 * vuexfire v2.2.0
 * (c) 2017 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.VuexFire={})}(this,function(e){"use strict";function r(e,r){for(var t=0;t<e.length;t++)if(e[t][".key"]===r)return t;return-1}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){return"function"==typeof e.key?e.key():e.key}function i(e){return"function"==typeof e.ref?e=e.ref():"object"==typeof e.ref&&(e=e.ref),e}function o(e){var r=e.val(),i=t(r)?r:{".value":r};return i[".key"]=n(e),i.$key=n(e),i.$ref=e.ref.toString(),i.$priority=e.getPriority(),i.$length=e.numChildren(),i}function c(e){var r=e.key,t=e.source,n=e.cancelCallback,i=e.commit,c=e.state;return{value:t.on("value",function(e){i(f,{type:f,key:r,record:o(e),state:c},p)},n)}}function a(e){var t=e.key,i=e.source,c=e.cancelCallback,a=e.wait,u=e.commit,s=e.state,f=[],E=function(){u(l,{type:l,state:s,key:t,value:f},p)};a?i.once("value",E):E();var R=i.on("child_added",function(e,n){var i=n?r(f,n)+1:0;u(d,{type:d,state:s,key:t,index:i,array:a&&f,record:o(e)},p)},c),b=i.on("child_removed",function(e){var i=r(f,n(e));u(k,{type:k,state:s,key:t,index:i,array:a&&f},p)},c);return{child_added:R,child_changed:i.on("child_changed",function(e){var i=r(f,n(e));u(y,{type:y,state:s,key:t,index:i,array:a&&f,record:o(e)},p)},c),child_removed:b,child_moved:i.on("child_moved",function(e,i){var c=r(f,n(e)),l=i?r(f,i)+1:0;u(v,{type:v,state:s,key:t,index:c,newIndex:l+=c<l?-1:0,array:a&&f,record:o(e)},p)},c)}}function u(e){var r=e.state,n=e.commit,o=e.key,u=e.source,f=e.options,l=f.cancelCallback,d=f.readyCallback,y=f.wait;if(void 0===y&&(y=!0),!t(u))throw new Error("VuexFire: invalid Firebase binding source.");if(!(o in r))throw new Error("VuexFire: cannot bind undefined property '"+o+"'. Define it on the state first.");var v=A.get(n);v||(v={sources:Object.create(null),listeners:Object.create(null)},A.set(n,v)),o in v.sources&&s({commit:n,key:o}),v.sources[o]=i(u),d&&u.once("value",d);var k;k=r[o]&&"length"in r[o]?a({key:o,source:u,cancelCallback:l,wait:y,commit:n,state:r}):c({key:o,source:u,cancelCallback:l,commit:n,state:r}),v.listeners[o]=k}function s(e){var r=e.commit,t=e.key,n=A.get(r);if(n||(n={sources:Object.create(null),listeners:Object.create(null)},A.set(r,n)),!(t in n.sources))throw new Error("VuexFire: cannot unbind '"+t+"' because it wasn't bound.");var i=n.sources[t],o=n.listeners[t];for(var c in o)i.off(c,o[c]);delete n.sources[t],delete n.listeners[t]}var f="vuexfire/OBJECT_VALUE",l="VUEXFIRE_ARRAY_INITIALIZE",d="vuexfire/ARRAY_ADD",y="vuexfire/ARRAY_CHANGE",v="vuexfire/ARRAY_MOVE",k="vuexfire/ARRAY_REMOVE",E=Object.freeze({VUEXFIRE_OBJECT_VALUE:f,VUEXFIRE_ARRAY_INITIALIZE:l,VUEXFIRE_ARRAY_ADD:d,VUEXFIRE_ARRAY_CHANGE:y,VUEXFIRE_ARRAY_MOVE:v,VUEXFIRE_ARRAY_REMOVE:k}),R={};R[f]=function(e,r){var t=r.key,n=r.record;e[t]=n},R[l]=function(e,r){var t=r.key,n=r.value;e[t]=n},R[d]=function(e,r){var t=r.key,n=r.index,i=r.record,o=r.array;(o=o||e[t]).splice(n,0,i)},R[y]=function(e,r){var t=r.key,n=r.index,i=r.record,o=r.array;(o=o||e[t]).splice(n,1,i)},R[v]=function(e,r){var t=r.key,n=r.index,i=(r.record,r.newIndex),o=r.array;(o=o||e[t]).splice(i,0,o.splice(n,1)[0])},R[k]=function(e,r){var t=r.key,n=r.index,i=r.array;(i=i||e[t]).splice(n,1)};var b={};Object.keys(E).forEach(function(e){var r=E[e];b[r]=function(e,t){R[r](t.state,t)}});var p={root:!0},A=new WeakMap;e.firebaseMutations=b,e.firebaseAction=function(e){return function(r,t){var n=r.state,i=r.commit;return r.bindFirebaseRef=function(e,r,t){return void 0===t&&(t={}),u({state:n,commit:i,key:e,source:r,options:t})},r.unbindFirebaseRef=function(e){return s({commit:i,key:e})},e(r,t)}},Object.defineProperty(e,"__esModule",{value:!0})});